scalar JSON
scalar DateTime
scalar URL

type TelemetryError{
	message: String
	code: String
}

type Query {
	temperatureCelsius(hiveId: ID!, timeRangeMin: Int): MetricListResult
	humidityPercent(hiveId: ID!, timeRangeMin: Int): MetricListResult
	weightKg(hiveId: ID!, timeRangeMin: Int): MetricListResult
	weightKgAggregated(hiveId: ID!, days: Int!, aggregation: AggregationType): MetricListResult
	entranceMovementToday(hiveId: ID!, boxId: ID!): BeeMovementInOutResult
	entranceMovement(hiveId: ID!, boxId: ID, timeFrom: DateTime!, timeTo: DateTime!): EntranceMovementResult
	populationMetrics(hiveId: ID!, days: Int): PopulationMetricsResult
}

enum AggregationType {
	DAILY_AVG
	DAILY_MAX
	DAILY_MIN
}

type BeeMovementInOutResult {
	beesIn: Float
	beesOut: Float
	netFlow: Float
	avgSpeed: Float
	p95Speed: Float
	stationaryBees: Int
	detectedBees: Int
	beeInteractions: Int
	time: DateTime
}

type EntranceMovementRecord {
	id: ID!
	hiveId: ID!
	boxId: ID!
	beesOut: Float
	beesIn: Float
	time: DateTime!
	netFlow: Float
	avgSpeed: Float
	p95Speed: Float
	stationaryBees: Int
	detectedBees: Int
	beeInteractions: Int
}

type EntranceMovementList {
	metrics: [EntranceMovementRecord]
}

union EntranceMovementResult = EntranceMovementList | TelemetryError

type MetricFloat {
	"""Timestamp of the metric. We use short-hand name to save bandwidth as it is a repeated metric"""
	t: DateTime!

	"""Float value of the metric. We use short-hand name to save bandwidth as it is a repeated metric"""
	v: Float
}

type MetricFloatList {
	metrics: [MetricFloat]
}
union MetricListResult = MetricFloatList | TelemetryError

type PopulationMetric {
	"""Timestamp of the metric"""
	t: DateTime!

	"""Bee count"""
	beeCount: Int

	"""Drone count"""
	droneCount: Int

	"""Varroa mite count"""
	varroaMiteCount: Int

	"""Inspection ID if available"""
	inspectionId: String
}

type PopulationMetricsList {
	metrics: [PopulationMetric]
}

union PopulationMetricsResult = PopulationMetricsList | TelemetryError

type Mutation {
	addMetric(
		hiveId: ID!
		fields: MetricSetInput!
	): AddMetricResult

	addPopulationMetric(
		hiveId: ID!
		fields: PopulationMetricInput!
		inspectionId: String
	): AddMetricResult
}

type AddMetricMessage {
	message: String
}

union AddMetricResult = AddMetricMessage | TelemetryError

input MetricSetInput {
	temperatureCelsius: Float
	humidityPercent: Float
	weightKg: Float
}

input PopulationMetricInput {
	beeCount: Int
	droneCount: Int
	varroaMiteCount: Int
}

